(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{4445:(e,t,a)=>{Promise.resolve().then(a.bind(a,6638))},6638:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>F});var s=a(5155),r=a(2115),l=a(2659),n=a(5239),i=a(6265),o=a(6324),c=a(8425),d=a(7734),h=a(3697),x=a(3420),u=a(9339),m=a(2723),g=a(4035),p=a(9386),b=a(46);function f(e){var t;let{user:a,onSignOut:r}=e,l=(null==a||null==(t=a.user_metadata)?void 0:t.name)||(null==a?void 0:a.email);return(0,s.jsx)("div",{className:"w-full bg-white shadow-md p-4",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)(n.default,{src:"/Mavbeats.svg",alt:"MavBeats Logo",width:160,height:160}),(0,s.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"MavBeats"})]}),(0,s.jsxs)("div",{className:"flex gap-8",children:[(0,s.jsx)("a",{href:"#",className:"text-gray-500 hover:text-[#0064b1] transition",children:"Home"}),(0,s.jsx)("a",{href:"/",className:"font-bold text-[#0064b1] border-b-2 border-[#0064b1]",children:"Personal Stats"}),(0,s.jsx)("a",{href:"#",className:"text-gray-500 hover:text-[#0064b1] transition",children:"Campus Stats"})]}),(0,s.jsxs)("div",{className:"flex items-center gap-4",children:[(0,s.jsx)("p",{className:"text-sm text-gray-600 font-semibold text-right",children:l}),(0,s.jsx)("button",{onClick:r,className:"bg-[#c45517] text-white font-bold py-2 px-4 rounded-lg hover:opacity-90 transition duration-300",children:"Sign Out"})]})]})})}function y(){return(0,s.jsx)("div",{className:"flex justify-center items-center my-8",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"})})}console.log("URL:","https://hyzqbtdftjvpemznkpjq.supabase.co"),console.log("KEY:","sb_publishable_M7ZZ5liNqy2aSAcifu91gA_2-Gug57F");let j=(0,l.UU)("https://hyzqbtdftjvpemznkpjq.supabase.co","sb_publishable_M7ZZ5liNqy2aSAcifu91gA_2-Gug57F");function v(e){let{data:t,title:a}=e;if(!t||0===t.length)return(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No artist data available."});let r=40*t.length+50;return(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:a}),(0,s.jsx)(i.u,{width:"100%",height:r,children:(0,s.jsxs)(o.E,{data:t,layout:"vertical",margin:{top:5,right:30,left:0,bottom:5},children:[(0,s.jsx)(c.d,{strokeDasharray:"3 3"}),(0,s.jsx)(d.W,{type:"number",allowDecimals:!1}),(0,s.jsx)(h.h,{type:"category",dataKey:"name",tick:{fontSize:12},width:80,interval:0}),(0,s.jsx)(x.m,{cursor:{fill:"rgba(238, 238, 238, 0.5)"}}),(0,s.jsx)(u.y,{dataKey:"count",fill:"#0064B1"})]})})]})}function N(e){let{data:t,title:a}=e;return t&&0!==t.length?(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",children:a}),(0,s.jsx)("ol",{className:"list-decimal list-inside space-y-3",children:t.map(e=>(0,s.jsxs)("li",{className:"text-gray-700",children:[(0,s.jsx)("span",{className:"font-bold text-gray-800",children:e.name}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[" ","(",e.count," plays)"]})]},e.name))})]}):(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No artist data available."})}function w(e){return["edm","r&b","ccm","opm","vbs","lds"].includes(e.toLowerCase())?e.toUpperCase():e.replace(/(^|\s|-)\S/g,e=>e.toUpperCase())}function S(e){let{data:t,title:a,onGenreSelect:r}=e;if(!t||0===t.length)return(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No genre data available."});let l=t.map(e=>({...e,displayName:w(e.name)})),n=250+20*t.length,o=["#0088FE","#00C49F","#FFBB28","#FF8042","#AF19FF","#FF4560","#775DD0","#546E7A","#26a69a","#D10CE8"];return(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:a}),(0,s.jsx)(i.u,{width:"100%",height:n,children:(0,s.jsxs)(m.r,{children:[(0,s.jsx)(g.F,{data:l,dataKey:"count",nameKey:"displayName",cx:"50%",cy:"50%",outerRadius:100,onClick:e=>r(e.name),label:e=>e.displayName,children:l.map((e,t)=>(0,s.jsx)(p.f,{fill:o[t%o.length]},"cell-".concat(t)))}),(0,s.jsx)(x.m,{}),(0,s.jsx)(b.s,{})]})})]})}function C(e){let{data:t,title:a,onGenreSelect:r}=e;if(!t||0===t.length)return(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No genre data available."});let l=t.map(e=>({...e,displayName:w(e.name)})),n=40*t.length+50;return(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:a}),(0,s.jsx)(i.u,{width:"100%",height:n,children:(0,s.jsxs)(o.E,{data:l,layout:"vertical",margin:{top:5,right:30,left:0,bottom:5},children:[(0,s.jsx)(c.d,{strokeDasharray:"3 3"}),(0,s.jsx)(d.W,{type:"number",allowDecimals:!1}),(0,s.jsx)(h.h,{type:"category",dataKey:"displayName",tick:{fontSize:12},width:80,interval:0}),(0,s.jsx)(x.m,{}),(0,s.jsx)(u.y,{dataKey:"count",fill:"#0064b1",onClick:e=>r(e.name)})]})})]})}function k(e){let{data:t,title:a,onGenreSelect:r}=e;return t&&0!==t.length?(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",children:a}),(0,s.jsx)("ol",{className:"list-decimal list-inside space-y-2",children:t.map(e=>(0,s.jsxs)("li",{onClick:()=>r(e.name),className:"text-gray-700 p-1 rounded-md hover:bg-gray-100 cursor-pointer",children:[(0,s.jsx)("span",{className:"font-bold text-gray-800",children:w(e.name)}),(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[" ","(",e.count," instances)"]})]},e.name))})]}):(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No genre data available."})}function _(e){let{data:t,title:a}=e;if(!t||0===t.length)return(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No song data available."});let r=40*t.length+50;return(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-2",children:a}),(0,s.jsx)(i.u,{width:"100%",height:r,children:(0,s.jsxs)(o.E,{data:t,layout:"vertical",margin:{top:5,right:30,left:0,bottom:5},children:[(0,s.jsx)(c.d,{strokeDasharray:"3 3"}),(0,s.jsx)(d.W,{type:"number",allowDecimals:!1}),(0,s.jsx)(h.h,{type:"category",dataKey:"name",tick:{fontSize:12},width:80,interval:0}),(0,s.jsx)(x.m,{cursor:{fill:"rgba(238, 238, 238, 0.5)"}}),(0,s.jsx)(u.y,{dataKey:"count",fill:"#C45517"})]})})]})}function E(e){let{data:t,title:a}=e;return t&&0!==t.length?(0,s.jsxs)("div",{className:"bg-white border rounded-xl shadow p-6 mb-4",children:[(0,s.jsx)("h3",{className:"text-lg font-bold mb-4",children:a}),(0,s.jsx)("ol",{className:"list-decimal list-inside space-y-3",children:t.map(e=>(0,s.jsxs)("li",{className:"text-gray-700",children:[" ",(0,s.jsx)("span",{className:"font-bold text-gray-800",children:e.name})," by"," ",e.artist," ",(0,s.jsxs)("span",{className:"text-sm text-gray-500",children:[" (",e.count," plays)"]})," "]},"".concat(e.name,"-").concat(e.artist)))})]}):(0,s.jsx)("p",{className:"text-center text-gray-500 p-4",children:"No song data available."})}function M(e){let{songs:t,genre:a,onClear:r}=e;return(0,s.jsxs)("div",{className:"mt-8 bg-white border rounded-xl shadow p-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsxs)("h3",{className:"text-lg font-bold",children:["Top Songs for ",(0,s.jsx)("span",{className:"text-[#0064b1]",children:a})]}),(0,s.jsx)("button",{onClick:r,className:"text-sm text-gray-500 hover:text-gray-800",children:"\xd7 Clear"})]}),t.length>0?(0,s.jsx)("ol",{className:"list-decimal list-inside space-y-2",children:t.map(e=>(0,s.jsxs)("li",{children:[" ",(0,s.jsx)("span",{className:"font-semibold",children:e.name})," by"," ",e.artist," "]},"".concat(e.name,"-").concat(e.artist)))}):(0,s.jsx)("p",{className:"text-gray-500",children:"No specific songs found for this genre in your top tracks."})]})}let T=e=>{let{label:t,activeTab:a,onClick:r}=e,l=a===t.toLowerCase().replace(" ",""),n="text-[#0064B1] border-[#0064B1]";return"Top Songs"===t&&(n="text-[#C45517] border-[#C45517]"),(0,s.jsx)("button",{onClick:r,className:"px-4 py-2 text-lg font-semibold border-b-4 transition duration-300 ".concat(l?n:"border-transparent text-gray-500 hover:border-gray-300 hover:text-gray-700"),children:t})};function F(){var e;let[t,a]=(0,r.useState)(null),[l,i]=(0,r.useState)(""),[o,c]=(0,r.useState)(""),[d,h]=(0,r.useState)(!1),[x,u]=(0,r.useState)(""),[m,g]=(0,r.useState)([]),[p,b]=(0,r.useState)([]),[w,F]=(0,r.useState)([]),[B,A]=(0,r.useState)(new Map),[D,L]=(0,r.useState)(!0),[O,Y]=(0,r.useState)("topartists"),[q,z]=(0,r.useState)(null),[G,K]=(0,r.useState)([]),[P,U]=(0,r.useState)("bar"),[W,Z]=(0,r.useState)("bar"),[I,R]=(0,r.useState)("pie"),[H,J]=(0,r.useState)(10),[Q,V]=(0,r.useState)(10),[X,$]=(0,r.useState)(5);async function ee(){if(!t)return;L(!0);let{data:e,error:a}=await j.from("plays").select("artist_name, track_name, artist_ids").eq("user_id",t.user.id);if(a){console.error("Error fetching plays:",a),L(!1);return}let s={};e.forEach(e=>e.artist_name.split(", ").filter(e=>e).forEach(e=>s[e]=(s[e]||0)+1)),g(Object.entries(s).map(e=>{let[t,a]=e;return{name:t,count:a}}).sort((e,t)=>t.count-e.count));let r={};e.forEach(e=>{let t="".concat(e.track_name,"||").concat(e.artist_name);r[t]=(r[t]||0)+1}),b(Object.entries(r).map(e=>{let[t,a]=e,[s,r]=t.split("||");return{name:s,artist:r,count:a}}).sort((e,t)=>t.count-e.count));let l=[...new Set(e.flatMap(e=>e.artist_ids?e.artist_ids.split(","):[]))],{data:{session:n}}=await j.auth.getSession(),i=null==n?void 0:n.provider_token;if(i&&l.length>0)try{let e=new Map,t=[];for(let e=0;e<l.length;e+=50)t.push(l.slice(e,e+50));for(let a of t){let t=a.join(","),s=await fetch("https://api.spotify.com/v1/artists?ids=".concat(t),{headers:{Authorization:"Bearer ".concat(i)}}),r=await s.json();r&&r.artists&&r.artists.forEach(t=>{t&&e.set(t.name,t.genres)})}A(e);let a={};e.forEach(e=>e.forEach(e=>a[e]=(a[e]||0)+1));let s=Object.entries(a).map(e=>{let[t,a]=e;return{name:t,count:a}}).sort((e,t)=>t.count-e.count);F(s)}catch(e){console.error("Failed to fetch genres from Spotify:",e)}L(!1)}(0,r.useEffect)(()=>{let{data:{subscription:e}}=j.auth.onAuthStateChange((e,t)=>{a(t)});return()=>e.unsubscribe()},[]);let et=e=>{if(e){if(q===e){z(null),K([]);return}z(e),K(p.filter(t=>t.artist.split(", ").some(t=>{let a=B.get(t);return a&&a.includes(e)})).slice(0,10))}};async function ea(){u("Syncing with Spotify...");let{data:{session:e}}=await j.auth.getSession(),t=null==e?void 0:e.provider_token;if(!t)return void u("Error: Spotify token not found.");try{let a=new Date("2025-09-01T00:00:00").getTime(),s=await fetch("https://api.spotify.com/v1/me/player/recently-played?limit=50&after=".concat(a),{headers:{Authorization:"Bearer ".concat(t)}});if(!s.ok)throw Error("Failed to fetch from Spotify");let r=await s.json();if(!r.items||0===r.items.length)return void u("");let l=r.items.map(t=>({user_id:e.user.id,track_name:t.track.name,artist_name:t.track.artists.map(e=>e.name).join(", "),artist_ids:t.track.artists.map(e=>e.id).join(","),played_at:t.played_at}));await j.from("plays").upsert(l,{onConflict:"user_id, played_at"}),u("Sync complete!")}catch(e){u("Error: ".concat(e.message)),console.error(e)}}async function es(e){e.preventDefault(),h(!0);let{data:t,error:a}=await j.auth.signUp({email:l,password:o,options:{emailRedirectTo:window.location.origin}});console.log("Sign-up result:",t,a),a?u(" ".concat(a.message)):u("Check your Maverick email to confirm your account."),h(!1)}async function er(e){e.preventDefault(),h(!0);let{data:t,error:a}=await j.auth.signInWithPassword({email:l,password:o});console.log("Sign-in result:",t,a),a?u(" ".concat(a.message)):u(" Signed in successfully!"),h(!1)}async function el(){await j.auth.signOut()}(0,r.useEffect)(()=>{!async function(){t&&(await ea(),await ee())}()},[t]);let en=m.slice(0,H),ei=p.slice(0,Q),eo=w.slice(0,X);return t?(null==(e=t.user.identities)?void 0:e.some(e=>"spotify"===e.provider))?(0,s.jsxs)("div",{className:"min-h-screen bg-[#f7f7f7]",children:[(0,s.jsx)(f,{user:t.user,onSignOut:el}),(0,s.jsx)("main",{className:"text-gray-800 p-10",children:(0,s.jsxs)("div",{className:"max-w-4xl mx-auto",children:[(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h2",{className:"text-3xl font-bold",children:"Your Personal Stats"}),(0,s.jsx)("p",{className:"text-gray-500 mt-1",children:"Your listening history, updated automatically when you visit."})]}),(0,s.jsx)("div",{className:"border-b border-gray-200 mb-8",children:(0,s.jsxs)("nav",{className:"-mb-px flex gap-6","aria-label":"Tabs",children:[(0,s.jsx)(T,{label:"Top Artists",activeTab:O,onClick:()=>Y("topartists")}),(0,s.jsx)(T,{label:"Top Songs",activeTab:O,onClick:()=>Y("topsongs")}),(0,s.jsx)(T,{label:"Top Genres",activeTab:O,onClick:()=>Y("topgenres")})]})}),D?(0,s.jsx)(y,{}):(0,s.jsxs)("div",{children:["topartists"===O&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsxs)("select",{value:P,onChange:e=>U(e.target.value),className:"p-2 border rounded-md bg-white shadow-sm",children:[(0,s.jsx)("option",{value:"bar",children:"Bar Chart"}),(0,s.jsx)("option",{value:"list",children:"List"})]})}),"bar"===P&&(0,s.jsx)(v,{data:en,title:"Your Top Artists"}),"list"===P&&(0,s.jsx)(N,{data:en,title:"Your Top Artists"}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[H>10&&(0,s.jsx)("button",{onClick:()=>J(e=>Math.max(10,e-10)),className:"w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Show Less"}),m.length>H&&(0,s.jsx)("button",{onClick:()=>J(e=>e+10),className:"w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Show More"})]})]}),"topsongs"===O&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsxs)("select",{value:W,onChange:e=>Z(e.target.value),className:"p-2 border rounded-md bg-white shadow-sm",children:[(0,s.jsx)("option",{value:"bar",children:"Bar Chart"}),(0,s.jsx)("option",{value:"list",children:"List"})]})}),"bar"===W&&(0,s.jsx)(_,{data:ei,title:"Your Top Songs"}),"list"===W&&(0,s.jsx)(E,{data:ei,title:"Your Top Songs"}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[Q>10&&(0,s.jsx)("button",{onClick:()=>V(e=>Math.max(10,e-10)),className:"w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Show Less"}),p.length>Q&&(0,s.jsx)("button",{onClick:()=>V(e=>e+10),className:"w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Show More"})]})]}),"topgenres"===O&&(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsxs)("select",{value:I,onChange:e=>R(e.target.value),className:"p-2 border rounded-md bg-white shadow-sm",children:[(0,s.jsx)("option",{value:"pie",children:"Pie Chart"}),(0,s.jsx)("option",{value:"bar",children:"Bar Chart"}),(0,s.jsx)("option",{value:"list",children:"List"})]})}),"pie"===I&&(0,s.jsx)(S,{data:eo,title:"Your Top Genres",onGenreSelect:et}),"bar"===I&&(0,s.jsx)(C,{data:eo,title:"Your Top Genres",onGenreSelect:et}),"list"===I&&(0,s.jsx)(k,{data:eo,title:"Your Top Genres",onGenreSelect:et}),(0,s.jsxs)("div",{className:"flex gap-4 justify-center",children:[X>5&&(0,s.jsx)("button",{onClick:()=>$(e=>Math.max(5,e-5)),className:"w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Show Less"}),w.length>X&&(0,s.jsx)("button",{onClick:()=>$(e=>e+5),className:"w-full text-center bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300",children:"Show More"})]}),q?(0,s.jsx)(M,{songs:G,genre:q,onClear:()=>z(null)}):(0,s.jsx)("div",{className:"mt-8 bg-white border rounded-xl shadow p-6 text-center text-gray-500",children:(0,s.jsx)("p",{children:"Click a genre above to see your top songs from that category."})})]})]})]})})]}):(0,s.jsxs)("main",{className:"min-h-screen bg-[#ffffff] flex flex-col items-center justify-center p-10 text-center",children:[(0,s.jsxs)("h1",{className:"text-3xl font-bold text-gray-800 mb-4",children:["Almost there, ",t.user.email,"!"]}),(0,s.jsx)("p",{className:"text-lg text-gray-600 mb-8",children:"Please connect your Spotify account to continue."}),(0,s.jsx)("button",{onClick:()=>j.auth.signInWithOAuth({provider:"spotify",options:{scopes:"user-read-recently-played user-top-read user-read-email"}}),className:"bg-[#1DB954] text-white font-bold py-3 px-8 rounded-full hover:opacity-90 transition duration-300",children:"Connect Spotify"}),(0,s.jsx)("button",{onClick:el,className:"text-sm text-gray-500 mt-8 hover:underline",children:"Sign Out"})]}):(0,s.jsxs)("main",{className:"min-h-screen bg-[#ffffff] flex flex-col items-center justify-center p-10 text-center",children:[(0,s.jsx)(n.default,{src:"/Mavbeats.svg",alt:"MavBeats Logo",width:360,height:360,className:"mb-6"}),(0,s.jsx)("h1",{className:"text-5xl font-bold text-[#0064b1] mb-4",children:"MavBeats"}),(0,s.jsx)("p",{className:"text-lg text-gray-600 mb-8",children:"Sign in or create an account with your Maverick email."}),(0,s.jsxs)("form",{className:"w-full max-w-sm",children:[(0,s.jsx)("input",{type:"email",placeholder:"your.name@mavs.uta.edu",value:l,onChange:e=>i(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md mb-4 text-gray-800",required:!0}),(0,s.jsx)("input",{type:"password",placeholder:"Password",value:o,onChange:e=>c(e.target.value),className:"w-full px-4 py-2 border border-gray-300 rounded-md mb-4 text-gray-800",required:!0}),(0,s.jsxs)("div",{className:"flex gap-4",children:[(0,s.jsx)("button",{onClick:er,disabled:d,className:"w-full bg-[#0064b1] text-white font-bold py-3 px-4 rounded-md hover:opacity-90 transition duration-300 disabled:bg-gray-400",children:d?"...":"Sign In"}),(0,s.jsx)("button",{onClick:es,disabled:d,className:"w-full bg-[#c45517] text-white font-bold py-3 px-4 rounded-md hover:opacity-90 transition duration-300 disabled:bg-gray-400",children:d?"...":"Sign Up"})]})]}),(0,s.jsx)("p",{className:"mt-4 text-sm font-semibold ".concat(x.startsWith("Error")?"text-red-500":"text-green-500"),children:x})]})}}},e=>{e.O(0,[45,441,255,358],()=>e(e.s=4445)),_N_E=e.O()}]);